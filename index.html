<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ponsonby Prints by Taylor and George</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2em; background: #fafafa; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 0.5em; }
        th { background: #eee; }
        .redirect-btn {
            display: inline-block;
            background: #1976d2;
            color: #fff;
            padding: 0.75em 2em;
            margin-bottom: 2em;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }
        .redirect-btn:hover {
            background: #1252a2;
        }
    </style>
</head>
<body>
    <h1>Spreadsheet Status Viewer</h1>
    <a class="redirect-btn" href="https://docs.google.com/forms/d/e/1FAIpQLSdoHfj0QRgsfI7EtPWoPc7K-YchPoPFjZar53TnVv0M6hGykg/viewform?usp=header" target="_blank" rel="noopener">
        Click here for form
    </a>
    <table id="status-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data goes here -->
        </tbody>
    </table>
    <script>
    // Google Sheet as CSV
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1kk6iR1kxubokQLowXvSAxYIHwrb8eJVuCnR2wfHaL6I/export?format=csv&id=1kk6iR1kxubokQLowXvSAxYIHwrb8eJVuCnR2wfHaL6I&gid=0';

    // Status mapping
    const statusMap = {
        "1": "Need payment",
        "2": "To print",
        "3": "To deliver",
        "4": "Done"
    };

    // Simple CSV parser
    function parseCSV(text) {
        const rows = [];
        let insideQuote = false, value = '', row = [];
        for (let i = 0; i < text.length; i++) {
            const c = text[i];
            if (c === '"') {
                if (insideQuote && text[i+1] === '"') { value += '"'; i++; }
                else { insideQuote = !insideQuote; }
            } else if (c === ',' && !insideQuote) {
                row.push(value);
                value = '';
            } else if ((c === '\n' || c === '\r') && !insideQuote) {
                if (value || row.length) row.push(value);
                if (row.length) rows.push(row);
                value = '';
                row = [];
                if (c === '\r' && text[i+1] === '\n') i++;
            } else { value += c; }
        }
        if (value || row.length) { row.push(value); rows.push(row); }
        return rows;
    }

    fetch(SHEET_CSV_URL)
        .then(response => response.text())
        .then(csv => {
            const rows = parseCSV(csv);
            if (!rows.length) {
                alert("No data found in spreadsheet!");
                return;
            }
            // Find column indices
            const header = rows[0].map(h => h.trim());
            const nameCol = header.findIndex(col => col === "Name");
            // Use the last ID column
            let idCol = -1;
            for (let i = header.length - 1; i >= 0; i--) {
                if (header[i] === "ID") {
                    idCol = i;
                    break;
                }
            }
            if (nameCol === -1 || idCol === -1) {
                alert("Name or ID column not found!");
                return;
            }
            const tbody = document.querySelector('#status-table tbody');
            tbody.innerHTML = '';
            rows.slice(1).forEach(row => {
                const name = row[nameCol] && row[nameCol].trim();
                const idRaw = row[idCol] && row[idCol].trim();
                if (name && idRaw) {
                    // If the ID contains "=", split and use the number part
                    let id = idRaw;
                    let status = idRaw;
                    let match = /^(\d+)=/.exec(idRaw);
                    if (match) {
                        id = match[1];
                        status = statusMap[id] || idRaw;
                    } else {
                        status = statusMap[idRaw] || idRaw;
                    }
                    const tr = document.createElement('tr');
                    const tdName = document.createElement('td');
                    const tdStatus = document.createElement('td');
                    tdName.textContent = name;
                    tdStatus.textContent = status;
                    tr.appendChild(tdName);
                    tr.appendChild(tdStatus);
                    tbody.appendChild(tr);
                }
            });
        })
        .catch(err => {
            alert("Failed to load sheet: " + err);
        });
    </script>
</body>
</html>
